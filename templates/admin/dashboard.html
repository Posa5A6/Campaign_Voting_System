{% extends "admin/base.html" %}
{% load static %}

{% block title %}Dashboard | Admin{% endblock %}
{% block page_title %}Admin Dashboard{% endblock %}
{% block page_subtitle %}Monitor campaigns, votes, and platform activity{% endblock %}
{% block nav_dashboard %}active{% endblock %}

{% block top_actions %}
  <a href="{% url 'create_campaign' %}" class="btn btn-primary fw-semibold">
    <i class="bi bi-plus-lg me-1"></i> Create Campaign
  </a>
  <a href="{% url 'admin_campaigns' %}" class="btn btn-outline-dark fw-semibold">
    <i class="bi bi-layout-text-window-reverse me-1"></i> Manage Campaigns
  </a>
{% endblock %}

{% block content %}

<div class="row g-4">

  <!-- STAT CARDS -->
  <div class="col-md-4">
    <div class="admin-stat-card stat-blue">
      <div class="stat-left">
        <div class="stat-label">Total Campaigns</div>
        <div class="stat-value">{{ campaign_count }}</div>
        <div class="stat-sub">All created campaigns</div>
      </div>
      <div class="stat-icon">
        <i class="bi bi-collection-fill"></i>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="admin-stat-card stat-green">
      <div class="stat-left">
        <div class="stat-label">Total Votes</div>
        <div class="stat-value">{{ vote_count }}</div>
        <div class="stat-sub">Votes recorded so far</div>
      </div>
      <div class="stat-icon">
        <i class="bi bi-check2-square"></i>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="admin-stat-card stat-dark">
      <div class="stat-left">
        <div class="stat-label">Active Campaigns</div>
        <div class="stat-value">{{ active_campaigns }}</div>
        <div class="stat-sub">Currently running (flag)</div>
      </div>
      <div class="stat-icon">
        <i class="bi bi-broadcast"></i>
      </div>
    </div>
  </div>

  <!-- QUICK ACTIONS + SECURITY -->
  <div class="col-lg-5">
    <div class="card border-0 shadow-sm rounded-4 h-100">
      <div class="card-body p-4">
        <div class="d-flex align-items-center gap-3 mb-3">
          <div class="admin-icon-badge">
            <i class="bi bi-lightning-charge-fill"></i>
          </div>
          <div>
            <div class="fw-bold fs-5">Quick Actions</div>
            <div class="text-secondary small">Common admin tasks</div>
          </div>
        </div>

        <div class="d-grid gap-2">
          <a href="{% url 'create_campaign' %}" class="btn btn-primary fw-semibold admin-primary-btn">
            <i class="bi bi-plus-circle me-1"></i> Create a New Campaign
          </a>

          <a href="{% url 'admin_campaigns' %}" class="btn btn-outline-dark fw-semibold">
            <i class="bi bi-kanban me-1"></i> View / Manage Campaigns
          </a>

          <a href="{% url 'admin_logout' %}" class="btn btn-outline-danger fw-semibold">
            <i class="bi bi-box-arrow-right me-1"></i> Logout
          </a>
        </div>

        <div class="admin-divider my-4"></div>

        <div class="admin-note">
          <i class="bi bi-shield-lock me-2"></i>
          Admin actions affect live voting. Verify dates and candidates before publishing.
        </div>
      </div>
    </div>
  </div>

  <!-- RIGHT PANEL: SYSTEM HEALTH -->
  <div class="col-lg-7">
    <div class="card border-0 shadow-sm rounded-4 h-100">
      <div class="card-body p-4 p-lg-5">

        <div class="d-flex align-items-start justify-content-between gap-3 flex-wrap">
          <div>
            <h5 class="fw-bold mb-1">System Overview</h5>
            <p class="text-secondary mb-0">
              Snapshot of platform usage and activity.
            </p>
          </div>
          <span class="badge rounded-pill text-bg-success">
            <i class="bi bi-check-circle me-1"></i> Running
          </span>
        </div>

        <div class="admin-overview-grid mt-4">
          <div class="admin-mini">
            <div class="mini-k">Campaigns</div>
            <div class="mini-v">{{ campaign_count }}</div>
            <div class="mini-s">Total</div>
          </div>

          <div class="admin-mini">
            <div class="mini-k">Votes</div>
            <div class="mini-v">{{ vote_count }}</div>
            <div class="mini-s">Recorded</div>
          </div>

          <div class="admin-mini">
            <div class="mini-k">Live</div>
            <div class="mini-v">{{ active_campaigns }}</div>
            <div class="mini-s">Campaigns</div>
          </div>

          <div class="admin-mini">
            <div class="mini-k">Security</div>
            <div class="mini-v">OTP</div>
            <div class="mini-s">Enabled</div>
          </div>
        </div>

        <div class="admin-divider my-4"></div>

        <div class="admin-tip">
          <div class="tip-title">
            <i class="bi bi-stars me-2"></i> Pro Tip
          </div>
          <div class="tip-text">
            If a campaign end time is crossed, you can auto-mark it inactive inside dashboard load.
            (Weâ€™ll add that in view for you.)
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- OPTIONAL: RECENT CAMPAIGNS TABLE -->
  {% if recent_campaigns %}
  <div class="col-12">
    <div class="card border-0 shadow-sm rounded-4">
      <div class="card-body p-0">
        <div class="p-4 d-flex justify-content-between align-items-center flex-wrap gap-2">
          <div>
            <h5 class="fw-bold mb-1">Recent Campaigns</h5>
            <p class="text-secondary mb-0">Quick access to latest items.</p>
          </div>
          <a href="{% url 'admin_campaigns' %}" class="btn btn-outline-primary fw-semibold">
            View All
          </a>
        </div>

        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0 admin-table">
            <thead class="admin-thead">
              <tr>
                <th class="ps-4">Title</th>
                <th>End Date</th>
                <th>Status</th>
                <th class="text-end pe-4">Action</th>
              </tr>
            </thead>
            <tbody>
              {% for c in recent_campaigns %}
              <tr>
                <td class="ps-4">
                  <div class="fw-bold text-dark">{{ c.title }}</div>
                  <div class="text-secondary small">{{ c.description|truncatechars:60 }}</div>
                </td>
                <td class="text-secondary small">
                  {{ c.end_date|date:"M d, Y H:i" }}
                </td>
                <td>
                  {% if now and c.end_date < now %}
                    <span class="badge rounded-pill text-bg-dark">Ended</span>
                  {% else %}
                    <span class="badge rounded-pill text-bg-success">Live</span>
                  {% endif %}
                </td>
                <td class="text-end pe-4">
                  <a href="{% url 'admin_results' c.id %}" class="btn btn-sm btn-outline-dark fw-semibold">
                    Results
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      </div>
    </div>
  </div>
  {% endif %}

</div>

{% endblock %}
